<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CSV Download</title>
</head>
<body>
    <h1>Download Meeting Logs CSV</h1>
    <label for="meetingId">Meeting ID:</label>
    <input type="text" id="meetingId" value="cae757c9-83d8-453f-a8c5-214b37f134d1" />
    <button id="downloadBtn">Download CSV Logs</button>

    <script>
        document.getElementById('downloadBtn').addEventListener('click', async function() {
            var meetingId = document.getElementById('meetingId').value.trim();
            var baseUrl = 'http://localhost:5000';
            var downloadUrl = baseUrl.replace(/\/$/, '') + '/download-logs-excel' + (meetingId ? '?meetingId=' + meetingId : '');

            try {
                console.log('Fetching URL:', downloadUrl);
                var response = await fetch(downloadUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'text/csv',
                    },
                });

                console.log('Response status:', response.status);

                if (!response.ok) {
                    throw new Error('HTTP error! status: ' + response.status);
                }

                var blob = await response.blob();

                console.log('Blob size:', blob.size);

                if (blob.size === 0) {
                    throw new Error('Received empty file');
                }

                var url = window.URL.createObjectURL(blob);
                var link = document.createElement('a');
                link.href = url;
                link.download = meetingId ? 'meeting-logs-' + meetingId + '.csv' : 'meeting-logs.csv';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);

                alert('Download successful!');
            } catch (error) {
                console.error('Download failed:', error);
                alert('Download failed: ' + error.message);
            }
        });
    </script>
</body>
</html>
